<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Govern &#8211; James K Nelson</title>
	<atom:link href="/category/govern/feed/" rel="self" type="application/rss+xml" />
	<link>/</link>
	<description></description>
	<lastBuildDate>Tue, 03 Apr 2018 07:35:44 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.9.3</generator>
	<item>
		<title>Component-based state management for React</title>
		<link>/component-based-state-management-react/</link>
					<comments>/component-based-state-management-react/#respond</comments>
		
		<dc:creator><![CDATA[James K Nelson]]></dc:creator>
		<pubDate>Mon, 02 Apr 2018 08:50:00 +0000</pubDate>
				<category><![CDATA[Govern]]></category>
		<category><![CDATA[React]]></category>
		<guid isPermaLink="false">/?p=1186</guid>

					<description><![CDATA[<p>When I ask people what their favorite part of React is, one of the most frequent answers is &#8220;Components&#8221;. And I agree. React&#8217;s component system is magnificent. It lets you split your code into small, single-purpose parts. It lets you work on one part of the app, while your colleagues focus on something else. It... <a class="more-link" href="/component-based-state-management-react/">Continue reading <span class="meta-nav">&#8594;</span></a></p>
<p>The post <a rel="nofollow" href="/component-based-state-management-react/">Component-based state management for React</a> appeared first on <a rel="nofollow" href="/">James K Nelson</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>When I ask people what their favorite part of React is, one of the most frequent answers is &#8220;Components&#8221;.</p>
<p>And I agree. React&#8217;s component system is magnificent. It lets you split your code into small, single-purpose parts. It lets you work on one part of the app, while your colleagues focus on something else. It makes it simple to share useful parts with your team, and with a huge number of frontend developers all over the world.</p>
<p>But while React&#8217;s component system is great for creating view components, it can&#8217;t solve everything. And in particular, it can&#8217;t solve <em>state</em>.</p>
<h2>Three types of state</h2>
<p>React components are great at handling <strong>view state</strong>, like animations and transitions. And that&#8217;s no accident. After all, each React Component is tied at some level to the DOM, which is an abstraction for your application&#8217;s view.</p>
<p>But not all state is view state.</p>
<p>This is part of why Redux is so popular. It recognises that not all state is view state. It gives you somewhere to put what I call <strong>environment state</strong>, or information that must be accessible throughout your entire appliaction.</p>
<p>Examples of environment state include:</p>
<ul>
<li>cached data</li>
<li>in-progress http requests</li>
<li>authentication</li>
</ul>
<p>But even then, some state just doesn&#8217;t fit a Redux store.</p>
<p>This is because there is a third type of state, that isn&#8217;t global, and isn&#8217;t tied to the DOM. I call it <strong>control state</strong>.</p>
<p>As an example, consider a sign-up form component. You may want to re-use this component in multiple places. However, you may <em>also</em> want the state persist even when the component is not in the DOM. The state isn&#8217;t view state, and it isn&#8217;t environment state &#8212; it&#8217;s control state.</p>
<p>Examples of control state include:</p>
<ul>
<li>form state</li>
<li>errors from POST requests</li>
<li>filters and sort orders</li>
<li>selected items</li>
</ul>
<p>In today&#8217;s React apps, control state is often <a href="https://reactjs.org/docs/lifting-state-up.html">lifted up</a> and treated as view state, or forced into a global Redux store. But while this kind of works, it feels like a missed opportunity. The thing is, React is all about components. And if you can create a <code>&lt;SignUpForm&gt;</code> view component, why can&#8217;t you create a <em>store</em> component too?</p>
<h2>Store components</h2>
<p>The thing about state management code is that it is often easily reusable. The problem is that <em>React</em> components are tied to the DOM, while control state is independent from the DOM.</p>
<p>So let&#8217;s take a step back for a moment, and imagine what a store component might look like if it <em>wasn&#8217;t</em> tied to the DOM.</p>
<p>To start, a store component would probably publish raw objects instead of rendering state, so it would have a <code>publish()</code> method in place of <code>render()</code>. It could still have <code>state</code> and <code>props</code> properties, and follow patterns we&#8217;re familiar with from React components.</p>
<p>Say we wanted to create a store component to represent the state of a single form field &#8212; perhaps it would look something like this:</p>
<pre><code>class FieldModel extends Component {
  static defaultProps = {
    defaultValue: ''
  }

  constructor(props) {
    super(props)

    this.state = {
      value: props.defaultValue,
    }
  }

  // The only change is that control components publish objects instead of
  // rendering DOM nodes.
  publish() {
    let value = this.state.value
    let error = this.props.validate ? this.props.validate(value) : null

    return {
      value: this.state.value,
      error: error,
      change: this.change,
    }
  }

  change = (newValue) =&gt; {
    this.setState({
      value: newValue,
    })
  }
}
</code></pre>
<p>Actually, as you may have suspected, <em>this component is real code</em>. You can see it <a href="https://codesandbox.io/s/0y10o4977l">live on CodeSandbox</a>. The only trick is that it isn&#8217;t a React component. It&#8217;s a <a href="https://github.com/jamesknelson/govern#govern">Govern</a> component.</p>
<h2>Introducing Govern</h2>
<p>Govern is a library for managing state with <strong>store components</strong>. These are a lot like React components &#8211; they can receive props, call <code>setState</code>, and define lifecycle methods. They can be defined as classes, or as stateless functions.</p>
<p>But importantly, store components publish raw JavaScript, so they&#8217;re not tied to the DOM.</p>
<p>Store components can be used to handle your app&#8217;s environment and control state, including actions, side effects and selectors. This means that Govern can replace redux (or MobX), redux-thunk, redux-saga, reselect, and even recompose.</p>
<p>But Govern works great with existing tools too. For example, <a href="https://gist.github.com/jamesknelson/92614d6be9d4076f3319623734d75abc">this gist</a> demonstrates a simple component that lets you interact with your existing Redux store from Govern.</p>
<p>And the best thing? <strong>If you know React, then you already know most of Govern&#8217;s API, so you&#8217;ll be productive in no time.</strong></p>
<p>The best way to get started is to walk through my <a href="/sensible-react-forms-with-govern/">guide to React forms with Govern</a>. Then, you can try it out <a href="https://codesandbox.io/s/8zxv9kq9vl">live on CodeSandbox</a>, or get more details from the <a href="https://github.com/jamesknelson/govern#api-documentation">API Reference</a>.</p>
<p>And if you like what you see or find any issues, let me know with a star or an issue on the <a href="https://github.com/jamesknelson/govern">GitHub project</a>!</p>
<p>One last thing &#8211; I&#8217;m using Govern in my own apps, so I&#8217;ll be keeping you up to date with my experiences over the coming months. If you haven&#8217;t already, make sure you stay in the loop by joining my newsletter. I&#8217;ll even throw in a few PDF cheatsheets when you do:</p>
<script src="https://app.convertkit.com/assets/CKJS4.js?v=21"></script>

<div class="ck_form ck_vertical_subscription_form">
  <div class="ck_form_content">
      <h3 class="ck_form_title">I will send you useful articles, cheatsheets and code.</h3>
      <div class="ck_description">
          I won't send you useless inbox filler. <em>No spam, ever.</em>
      </div>
  </div>

  <div class="ck_form_fields">

    <div id='ck_success_msg'  style='display:none;'>
      <p>Thanks! Please check your email for the link to your cheatsheets.</p>
    </div>

    <!--  Form starts here  -->
    <form id="ck_subscribe_form" class="ck_subscribe_form" action="https://app.convertkit.com/landing_pages/4375/subscribe" data-remote="true">
      <input type="hidden" value="{&quot;embed_style&quot;:&quot;inline&quot;,&quot;embed_trigger&quot;:&quot;scroll_percentage&quot;,&quot;scroll_percentage&quot;:&quot;70&quot;,&quot;delay_seconds&quot;:&quot;10&quot;,&quot;display_position&quot;:&quot;br&quot;,&quot;display_devices&quot;:&quot;all&quot;,&quot;days_no_show&quot;:&quot;15&quot;,&quot;converted_behavior&quot;:&quot;show&quot;}" id="ck_form_options"></input>
      <input type="hidden" name="id" value="4375" id="landing_page_id"></input>
      <div class="ck_errorArea">
        <div id="ck_error_msg" style="display:none">
          <p>There was an error submitting your subscription. Please try again.</p>
        </div>
      </div>
      <div class="ck_control_group ck_first_name_field_group">
        <label class="ck_label" for="ck_firstNameField">First Name</label>
        <input type="text" name="first_name" class="ck_first_name" id="ck_firstNameField"></input>
      </div>
      <div class="ck_control_group ck_email_field_group">
        <label class="ck_label" for="ck_emailField">Email Address</label>
          <input type="email" name="email" class="ck_email_address" id="ck_emailField" required></input>
      </div>
      <label class='ck_checkbox' style='display:none;'>
        <input class="optIn ck_course_opted" name='course_opted' type="checkbox" id="optIn" checked />
        <span class='ck_opt_in_prompt'>I'd like to receive the free email course.</span>
      </label>

      <button class="subscribe_button ck_subscribe_button btn fields" id='ck_subscribe_button'>
       Join over 13,000 subscribers
      </button>
      <span class="ck_guarantee">
        Unsubscribe at any time.
      </span>
    </form>
  </div>

 </div>


<style type="text/css">/* Layout */
  .ck_form {
  /* divider image */
  background: #fff url(data:image/gif;base64,R0lGODlhAQADAIABAMzMzP///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUQ5NjM5RjgxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUQ5NjM5RjkxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxRDk2MzlGNjFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxRDk2MzlGNzFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAEAAAEALAAAAAABAAMAAAICRFIAOw==) repeat-y center top;
  font-family: 'Helvetica Neue', Helvetica, Arial, Verdana, sans-serif;
  line-height: 1.5em;
  overflow: hidden;
  color: #666;
  font-size: 16px;
  border-top: solid 20px #3071b0;
  border-top-color: #b30e2f;
  border-bottom: solid 10px #3d3d3d;
  border-bottom-color: #5f0719;
  -webkit-box-shadow: 0px 0px 5px rgba(0,0,0,.3);
  -moz-box-shadow: 0px 0px 5px rgba(0,0,0,.3);
  box-shadow: 0px 0px 5px rgba(0,0,0,.3);
  clear: both;
  margin: 20px 0px;
}

.ck_form * {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

#ck_subscribe_form {
  clear: both;
}

/* Element Queries — uses JS */

.ck_form_content, .ck_form_fields {
  width: 50%;
  float: left;
  padding: 5%;
}

.ck_form.ck_horizontal {
}

.ck_form_content {
  border-bottom: none;
}

.ck_form.ck_vertical {
  background: #fff;
}

.ck_vertical .ck_form_content, .ck_vertical .ck_form_fields {
  padding: 10%;
  width: 100%;
  float: none;
}

.ck_vertical .ck_form_content {
  border-bottom: 1px dotted #aaa;
  overflow: hidden;
}

/* Trigger the vertical layout with media queries as well */

@media all and (max-width: 499px) {

  .ck_form {
    background: #fff;
  }

  .ck_form_content, .ck_form_fields {
    padding: 10%;
    width: 100%;
    float: none;
  }

  .ck_form_content {
    border-bottom: 1px dotted #aaa;
  }

}

/* Content */

.ck_form_content h3 {
  margin: 0px 0px 15px;
  font-size: 24px;
  padding: 0px;
}


.ck_form_content p {
  font-size: 14px;
}

.ck_image {
  float: left;
  margin-right: 5px;
}

/* Form fields */

.ck_errorArea {
  display: none;
}

#ck_success_msg {
  padding: 10px 10px 0px;
  border: solid 1px #ddd;
  background: #eee;
}

.ck_label {
  font-size: 14px;
  font-weight: bold;
}

.ck_form input[type="text"], .ck_form input[type="email"] {
  font-size: 14px;
  padding: 10px 8px;
  width: 100%;
  border: 1px solid #d6d6d6; /* stroke */
  -moz-border-radius: 4px;
  -webkit-border-radius: 4px;
  border-radius: 4px; /* border radius */
  background-color: #f8f7f7; /* layer fill content */
  margin-bottom: 5px;
  height: auto;
}

.ck_form input[type="text"]:focus, .ck_form input[type="email"]:focus {
  outline: none;
  border-color: #aaa;
}

.ck_checkbox {
  padding: 10px 0px 10px 20px;
  display: block;
  clear: both;
}

.ck_checkbox input.optIn {
  margin-left: -20px;
  margin-top: 0;
}
.ck_form .ck_opt_in_prompt {
  margin-left: 4px;
}
.ck_form .ck_opt_in_prompt p {
  display: inline;
}

.ck_form .ck_subscribe_button {
    width: 100%;
    color: #fff;
    margin: 10px 0px 0px;
    padding:  10px 0px;
    font-size: 18px;
    background: #b30e2f;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    border-radius: 4px; /* border radius */
    cursor: pointer;
    border: none;
    text-shadow: none;
  }


.ck_form .ck_guarantee {
  color: #626262;
  font-size: 12px;
  text-align: center;
  padding: 5px 0px;
  display: block;
}

.ck_form .ck_powered_by {
  display: block;
  color: #aaa;
}

.ck_form .ck_powered_by:hover {
  display: block;
  color: #444;
}

.ck_converted_content {
  display: none;
  padding: 5%;
  background: #fff;
}



</style>
<p>Thanks for reading, and until next time, happy Governing!</p>
<p>The post <a rel="nofollow" href="/component-based-state-management-react/">Component-based state management for React</a> appeared first on <a rel="nofollow" href="/">James K Nelson</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>/component-based-state-management-react/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Sensible React Forms, with Govern</title>
		<link>/sensible-react-forms-with-govern/</link>
					<comments>/sensible-react-forms-with-govern/#respond</comments>
		
		<dc:creator><![CDATA[James K Nelson]]></dc:creator>
		<pubDate>Mon, 02 Apr 2018 08:36:10 +0000</pubDate>
				<category><![CDATA[Govern]]></category>
		<category><![CDATA[React]]></category>
		<guid isPermaLink="false">/?p=1176</guid>

					<description><![CDATA[<p>Creating forms with React can be a little tricky. Perhaps you decide to use Raw React, and end up repeating the same handler code each time you need a new field. Or maybe you force the non-global form state into a global Redux store. Either way, things get awkward quickly. But luckily, React forms don&#8217;t... <a class="more-link" href="/sensible-react-forms-with-govern/">Continue reading <span class="meta-nav">&#8594;</span></a></p>
<p>The post <a rel="nofollow" href="/sensible-react-forms-with-govern/">Sensible React Forms, with Govern</a> appeared first on <a rel="nofollow" href="/">James K Nelson</a>.</p>
]]></description>
										<content:encoded><![CDATA[<p>Creating forms with React can be a little tricky. Perhaps you decide to use Raw React, and end up repeating the same handler code each time you need a new field. Or maybe you force the non-global form state into a global Redux store. Either way, things get awkward quickly.</p>
<p>But luckily, React forms don&#8217;t <em>have</em> to be awkward. In fact, they can be downright easy. And the trick is simple: you just need to understand that form state isn&#8217;t like other state.</p>
<h2>Three types of state</h2>
<p>As it turns out, the problem is that web applications usually have three types of state, and we only talk about two of them.</p>
<h3>1. View State</h3>
<p>View state includes anything that is associated with the DOM itself. Examples include the state of animations and transitions.</p>
<p>React component state is great is a perfect way to store it, as each React component is tied to a DOM node.</p>
<h3>2. Environment state</h3>
<p>Environment state includes anything that is relevant throughout your entire application. Examples include the current user&#8217;s details, received data, or in-progress requests.</p>
<p>Redux is great at storing environment state, as you generally only have a single Redux store, which can be accessed anywhere via React context.</p>
<h3>3. Control state</h3>
<p>Control state includes anything associated with user interactions. Examples include the state of forms, selected items, and error messages.</p>
<p>The thing about control state is that it is associated with a specific part of the application, which may be loaded, disposed, or re-used in multiple places. This means that <em>it isn&#8217;t environment state</em>, and it doesn&#8217;t fit well in a global Redux store.</p>
<p>And while you <em>can</em> put form state in React components, it really doesn&#8217;t belong in them. After all, sometimes you want to keep your form state around after the DOM nodes disappear. Sure, you could <a href="https://reactjs.org/docs/lifting-state-up.html">lift your state</a> up, except now you can&#8217;t easily re-use the logic. And isn&#8217;t React about reusable components?</p>
<p>But&#8230; what if you could define components that <em>weren&#8217;t</em> tied to the DOM?</p>
<h2>Introducing Govern</h2>
<p>Govern is a library for managing state with <strong>store components</strong>. These are a lot like React components &#8211; they can receive props, call <code>setState</code>, and define lifecycle methods. They can be defined as classes, or as stateless functions.</p>
<p>But instead of rendering elements, store components publish raw JavaScript, so they&#8217;re not tied to the DOM.</p>
<p>And the best thing? If you know React, then you already know most of Govern&#8217;s API, so you&#8217;ll be productive in no time. In fact, by the end of this short guide, you&#8217;ll be able to build a form with validation and connect it to a JSON API &#8212; and you&#8217;ll barely need to learn a thing!</p>
<p>So let&#8217;s get started by creating your first store component for managing form state.</p>
<h2>Defining store components</h2>
<p>Govern components are just JavaScript classes that extend <code>Govern.Component</code>. Like React components, they have props, state, and lifecycle methods.</p>
<p>For example, here&#8217;s how you&#8217;d create a <code>Model</code> component that handles state and validation for individual form fields:</p>
<pre><code>import * as Govern from 'govern'

class Model extends Govern.Component {
  static defaultProps = {
    defaultValue: ''
  }

  constructor(props) {
    super(props)

    this.state = {
      value: props.defaultValue,
    }
  }

  publish() {
    let value = this.state.value
    let error = this.props.validate ? this.props.validate(value) : null

    return {
      value: this.state.value,
      error: error,
      change: this.change,
    }
  }

  change = (newValue) =&gt; {
    this.setState({
      value: newValue,
    })
  }
}
</code></pre>
<p>Govern components have one major difference from React components: instead of <code>render()</code>, they take a <code>publish()</code> method. This is where you specify the component&#8217;s output, which will be computed each time the component&#8217;s props or state change.</p>
<h2>Subscribing to stores</h2>
<p>Now that you have a Model component, the next step is to subscribe to its published values from inside of your React app.</p>
<p>Govern exports a <code>&lt;Subscribe to&gt;</code> React component to handle this for you. This component takes a Govern element for its <code>to</code> prop, and a render function for its <code>children</code> prop. It calls the render function with each new published value &#8212; just like React&#8217;s context API.</p>
<p>Here&#8217;s a barebones example that connects a <code>&lt;Model&gt;</code> to an input field, using <code>&lt;Subscribe&gt;</code>.</p>
<pre><code>import * as React from 'react'
import * as ReactDOM from 'react-dom'
import { Subscribe } from 'react-govern'

ReactDOM.render(
  &lt;Subscribe to={&lt;Model validate={validateEmail} /&gt;}&gt;
    {emailModel =&gt;
      &lt;label&gt;
        Email: 
        &lt;input
          value={emailModel.value}
          onChange={e =&gt; emailModel.change(e.target.value)}
        /&gt;
        {
          emailModel.error &amp;&amp;
          &lt;p style={{color: 'red'}}&gt;{emailModel.error}&lt;/p&gt;
        }
      &lt;/label&gt;
    }
  &lt;/Subscribe&gt;,
  document.getElementById('root')
)

function validateEmail(value) {
  if (value.indexOf('@') === -1) {
    return "please enter a valid e-mail"
  }
}
</code></pre>
<p><a href="https://codesandbox.io/s/0y10o4977l">Try it live at CodeSandbox &raquo;</a></p>
<h2>Adding Govern to create-react-app</h2>
<p>If you&#8217;d like to follow along and create your own app &#8212; which I&#8217;d highly recommend &#8212; then all you need to do is create a new app with <code>create-react-app</code>, and then add govern:</p>
<pre><code>create-react-app govern-example
cd govern-example
npm install --save govern react-govern
npm run start
</code></pre>
<p>Once you&#8217;ve got Govern installed, you can just copy the above two code blocks into <code>index.js</code>, and you&#8217;re set! If you run into any trouble, take a look at the <a href="https://codesandbox.io/s/0y10o4977l">live example</a>.</p>
<hr />
<p>Did you get it to work? Then congratulations &#8212; you&#8217;ve just learned a new way to manage state! And all you need to remember is that:</p>
<ul>
<li>Store components extend from <code>Govern.Component</code> in place of <code>React.Component</code>.</li>
<li>Store components use a <code>publish</code> method in place of <code>render</code>.</li>
<li>You can subscribe to store components with <code>&lt;Subscribe to&gt;</code>.</li>
</ul>
<p>These three things will get you a long way. But I promised that you&#8217;d make a <em>form</em> component, and so far I&#8217;ve only demonstrated a <em>field</em> component&#8230;</p>
<h2>Combining stores</h2>
<p>Govern components have one special method that doesn&#8217;t exist on React components &#8212; <code>subscribe()</code>.</p>
<p>When a component&#8217;s <code>subscribe()</code> method returns some Govern elements, the component will subscribe to those elements, placing their latest published values on the component&#8217;s <code>subs</code> instance property. You can then use the value of <code>this.subs</code> within the component&#8217;s <code>publish()</code> method, allowing you to <em>combine</em> store components.</p>
<p>For example, you could combine two <code>&lt;Model&gt;</code> elements to create a <code>&lt;RegistrationFormModel&gt;</code> component:</p>
<pre><code>class RegistrationFormModel extends Govern.Component {
  static defaultProps = {
    defaultValue: { name: '', email: '' }
  }

  subscribe() {
    let defaultValue = this.props.defaultValue

    return {
      name: &lt;Model defaultValue={defaultValue.name} validate={validateNotEmpty} /&gt;,
      email: &lt;Model defaultValue={defaultValue.email} validate={validateEmail} /&gt;,
    }
  }

  publish() {
    return this.subs
  }
}

function validateNotEmpty(value) {
  if (!value) {
    return "please enter your name"
  }
}
</code></pre>
<h2>Field view components</h2>
<p>One of the benefits of using the same <code>&lt;Model&gt;</code> component for each field is that it makes creating reusable form <em>views</em> simpler. For example, you could create a <code>&lt;Field&gt;</code> React component to render your field models:</p>
<pre><code>class Field extends React.Component {
  render() {
    return (
      &lt;label style={{display: 'block'}}&gt;
        &lt;span&gt;{this.props.label}&lt;/span&gt;
        &lt;input
          value={this.props.model.value}
          onChange={this.handleChange}
        /&gt;
        {
          this.props.model.error &amp;&amp;
          &lt;p style={{color: 'red'}}&gt;{this.props.model.error}&lt;/p&gt;
        }
      &lt;/label&gt;
    )
  }

  handleChange = (e) =&gt; {
    this.props.model.change(e.target.value)
  }
}

ReactDOM.render(
  &lt;Subscribe to={&lt;RegistrationFormModel /&gt;}&gt;
    {model =&gt;
      &lt;div&gt;
        &lt;Field label='Name' model={model.name} /&gt;
        &lt;Field label='E-mail' model={model.email} /&gt;
      &lt;/div&gt;
    }
  &lt;/Subscribe&gt;,
  document.getElementById('root')
)
</code></pre>
<p><a href="https://codesandbox.io/s/vv09or2853">Try it live at CodeSandbox &raquo;</a>.</p>
<h2>Stateless functional components</h2>
<p>You&#8217;ll sometimes find yourself creating components that just <code>subscribe()</code> to a few elements, and then re-publish the outputs without any changes. Govern provides a shortcut for defining this type of component: just return the elements you want to subscribe to from a plain function &#8212; like React&#8217;s stateless functional components.</p>
<p>For example, you could convert the above <code>&lt;RegistrationFormModel&gt;</code> component to a stateless functional component:</p>
<pre><code>const RegistrationFormModel = ({ defaultValue }) =&gt; ({
  name: &lt;Model defaultValue={defaultValue.name} validate={validateNotEmpty} /&gt;,
  email: &lt;Model defaultValue={defaultValue.email} validate={validateEmail} /&gt;
});

RegistrationFormModel.defaultProps = {
  defaultValue: { name: '', email: '' } 
}
</code></pre>
<p><a href="https://codesandbox.io/s/pyr7y18xq">Try it live at CodeSandbox &raquo;</a>.</p>
<h2>Calling a JSON API</h2>
<p>Once you have some data in your form, submitting it is easy &#8212; you just publish a <code>submit()</code> handler along with the form data. Everything you know about handling HTTP requests in React components transfers over to Govern components.</p>
<p>However, Govern does give you an advantage over vanilla React &#8212; your requests can be components too!</p>
<p>For example, this component takes the request body as props, makes a request in the <code>componentDidInstantiate()</code> lifecycle method, and emits the request status via the <code>publish()</code> method.</p>
<p><em>Note: I use the <a href="https://github.com/axios/axios">axios</a> package here to simplify the network code. If you&#8217;re following along, you can install it with <code>npm install --save axios</code>.</em></p>
<pre><code>import * as axios from "axios";

class PostRegistrationRequest extends Govern.Component {
  state = {
    status: 'fetching',
  }

  publish() {
    return this.state
  }

  componentDidInstantiate() {
    axios.post('/user', this.props.data)
      .then(response =&gt; {
        if (!this.isDisposed) {
          this.setState({
            status: 'success',
            result: response.data,
          })
        }
      })
      .catch((error = {}) =&gt; {
        if (!this.isDisposed) {
          this.setState({
            status: 'error',
            message: error.message || "Unknown Error",
          })
        }
      });
  }

  componentWillBeDisposed() {
    this.isDisposed = true
  }
}
</code></pre>
<p>You can then make a request by subscribing to a new <code>&lt;PostRegistrationRequest&gt;</code> element.</p>
<pre><code>class RegistrationFormController extends Govern.Component {
  state = {
    request: null
  };

  subscribe() {
    return {
      model: &lt;RegistrationFormModel /&gt;,
      request: this.state.request
    };
  }

  publish() {
    return {
      ...this.subs,
      canSubmit: this.canSubmit(),
      submit: this.submit
    };
  }

  canSubmit() {
    return (
      !this.subs.model.email.error &amp;&amp;
      !this.subs.model.name.error &amp;&amp;
      (!this.subs.request || this.subs.request.status === "error")
    );
  }

  submit = e =&gt; {
    e.preventDefault();

    if (this.canSubmit()) {
      let data = {
        email: this.subs.model.email.value,
        name: this.subs.model.name.value
      };

      this.setState({
        request: (
          &lt;PostRegistrationRequest data={data} key={new Date().getTime()} /&gt;
        )
      });
    }
  };
}

ReactDOM.render(
  &lt;Subscribe to={&lt;RegistrationFormController /&gt;}&gt;
    {({ canSubmit, model, request, submit }) =&gt; (
      &lt;form onSubmit={submit}&gt;
        {request &amp;&amp;
          request.status === "error" &amp;&amp; (
            &lt;p style={{ color: "red" }}&gt;{request.message}&lt;/p&gt;
          )}
        &lt;Field label="Name" model={model.name} /&gt;
        &lt;Field label="E-mail" model={model.email} /&gt;
        &lt;button type="submit" disabled={!canSubmit}&gt;
          Register
        &lt;/button&gt;
      &lt;/form&gt;
    )}
  &lt;/Subscribe&gt;,
  document.getElementById("root")
);
</code></pre>
<p><a href="https://codesandbox.io/s/8zxv9kq9vl">Try it live at CodeSandbox &raquo;</a>.</p>
<p>Did you see how the <code>key</code> prop is used in the above example? Just like React, changing <code>key</code> will result in a new component instance being created, and thus a new request being made each time the user clicks &#8220;Register&#8221;.</p>
<p>While request components can take a little getting used to, they have the benefit of being able to publish multiple statuses over time &#8212; where promises can only publish one. For example, you could publish <code>disconnected</code> or <code>unauthenticated</code> states, along with a <code>retry()</code> action to give the request another crack.</p>
<p>Request components also make it easy to share communication logic within and between applications. For an example, I use a <a href="https://gist.github.com/jamesknelson/ab93890eb26f2841a2f8846d4013b151"><code>&lt;Request&gt;</code> component</a> within my own applications.</p>
<h2>Performance note: selecting data</h2>
<p>Govern&#8217;s <code>&lt;Subscribe&gt;</code> component needs to call its render prop each time that <em>any</em> part of its output changes. This is great for small components, but as the output gets larger and more complicated, the number of re-renders will also grow &#8212; and a perceivable delay can creep into user interactions.</p>
<p>Where possible, you should stick to <code>&lt;Subscribe&gt;</code>. But in the rare case that there is noticeable lag, you can use Govern&#8217;s <code>&lt;Store of&gt;</code> component to instantiate a <em>Store</em> object, which allows you to manually manage subscriptions.</p>
<p>Once you have a <em>Store</em> object, there are two ways you can use it:</p>
<ul>
<li>You can access the latest output with its <code>getValue()</code> method.</li>
<li>You can return the store from a component&#8217;s <code>subscribe()</code> method, and then republish the individual parts that you want.</li>
</ul>
<p>For example, here&#8217;s how the above example would look with a <code>&lt;Store of&gt;</code> component. Note that this adds a fair amount of complexity &#8212; try to stick to <code>&lt;Subscribe to&gt;</code> unless performance becomes an issue.</p>
<pre><code>class MapDistinct extends Govern.Component {
  subscribe() {
    return this.props.from
  }
  shouldComponentUpdate(nextProps, nextState, nextSubs) {
    return nextProps.to(nextSubs) !== this.props.to(this.subs)
  }
  publish() {
    return this.props.to(this.subs)
  }
}

const Field = ({ model, label }) =&gt; (
  &lt;Subscribe to={model}&gt;
    {model =&gt; (
      &lt;label style={{ display: "block" }}&gt;
        &lt;span&gt;{label}&lt;/span&gt;
        &lt;input
          value={model.value}
          onChange={e =&gt; model.change(e.target.value)}
        /&gt;
        {model.error &amp;&amp; &lt;p style={{ color: "red" }}&gt;{model.error}&lt;/p&gt;}
      &lt;/label&gt;
    )}
  &lt;/Subscribe&gt;
);

ReactDOM.render(
  &lt;Store of={&lt;RegistrationFormController /&gt;}&gt;
    {store =&gt; (
      &lt;form onSubmit={store.getValue().submit}&gt;
        &lt;Subscribe
          to={&lt;MapDistinct from={store} to={output =&gt; output.request} /&gt;}
        &gt;
          {request =&gt;
            request &amp;&amp; request.status === "error" ? (
              &lt;p style={{ color: "red" }}&gt;{request.message}&lt;/p&gt;
            ) : null
          }
        &lt;/Subscribe&gt;
        &lt;Field
          label="Name"
          model={&lt;MapDistinct from={store} to={output =&gt; output.model.name} /&gt;}
        /&gt;
        &lt;Field
          label="E-mail"
          model={&lt;MapDistinct from={store} to={output =&gt; output.model.email} /&gt;}
        /&gt;
        &lt;Subscribe
          to={&lt;MapDistinct from={store} to={output =&gt; output.canSubmit} /&gt;}
        &gt;
          {canSubmit =&gt; (
            &lt;button type="submit" disabled={!canSubmit}&gt;
              Register
            &lt;/button&gt;
          )}
        &lt;/Subscribe&gt;
      &lt;/form&gt;
    )}
  &lt;/Store&gt;,
  document.getElementById("root")
);
</code></pre>
<p><a href="https://codesandbox.io/s/616xxyppyz">Try it live at CodeSandbox &raquo;</a>.</p>
<p>Note how the above example uses <code>getValue()</code> to access the <code>submit()</code> action, but uses <code>&lt;Subscribe&gt;</code> elsewhere. This is because we know that <code>submit</code> won&#8217;t change, and thus we don&#8217;t need to subscribe to future values.</p>
<p>Also note how the selector component defines a <code>shouldComponentUpdate()</code> method. If this <em>wasn&#8217;t</em> defined, then each update to the <code>from</code> store would cause a new publish &#8212; even if the published value didn&#8217;t change! Defining <code>shouldComponentUpdate()</code> gives you control over exactly which changes cause a publish &#8212; just like with React.</p>
<h2>Built-in components</h2>
<p>Govern has a number of built-in elements to help you reduce boilerplate and accomplish common tasks. These are particularly useful for creating selector components.</p>
<p>The three built-ins that you&#8217;ll use most often are:</p>
<ol>
<li><code>&lt;map from={Store | Element} to={output =&gt; mappedOutput} /&gt;</code></li>
</ol>
<p>Maps the output of <code>from</code>, using the function passed to <code>to</code>. Each publish on the <code>from</code> store will result in a new publish.</p>
<ol>
<li><code>&lt;flatMap from={Store | Element} to={output =&gt; mappedElement} /&gt;</code></li>
</ol>
<p>Maps the output of <code>from</code>, using the output of whatever element is returned by <code>to</code>. Each published of the <em>mapped</em> element results in a new publish.</p>
<ol>
<li><code>&lt;distinct by?={(x, y) =&gt; boolean} children&gt;</code></li>
</ol>
<p>Publishes the output of the child element, but only when it differs from the previous output. By default, outputs are compared using reference equality, but you can supply a custom comparison function via the <code>by</code> prop.</p>
<hr />
<p>For example, you could use the <code>&lt;flatMap&gt;</code> and <code>&lt;distinct&gt;</code> built-ins to rewrite the <code>&lt;MapDistinct&gt;</code> component from the previous example as a stateless functional component.</p>
<pre><code>const MapDistinct = props =&gt; (
  &lt;distinct&gt;
    &lt;map from={props.from} to={props.to} /&gt;
  &lt;/distinct&gt;
);
</code></pre>
<p><a href="https://codesandbox.io/s/0ozlm2lxjl">Try it live at CodeSandbox &raquo;</a>.</p>
<h2>What next?</h2>
<p>Believe it or not, you&#8217;ve just learned enough about Govern to make useful applications with it. Congratulations!</p>
<p>In fact, I already use Govern in my own projects. I wouldn&#8217;t yet recommend it for critical applications, but with your help, it will continue to steadily involve.</p>
<p>If you do find any issues while using Govern, and find the time to <a href="https://github.com/jamesknelson/govern/issues">file an issue</a>, you&#8217;ll be my new best friend. I&#8217;m also extremely open to pull requests, and would be happy to help get the word out about any components you&#8217;d like to share.</p>
<p>Finally, if you like what you see, please let me know with a <a href="https://github.com/jamesknelson/govern">star on GitHub</a>! And if you want to hear more about Govern, join my newsletter below &#8211; I&#8217;ll even throw in a few PDF cheatsheets as thanks!</p>
<script src="https://app.convertkit.com/assets/CKJS4.js?v=21"></script>

<div class="ck_form ck_vertical_subscription_form">
  <div class="ck_form_content">
      <h3 class="ck_form_title">I will send you useful articles, cheatsheets and code.</h3>
      <div class="ck_description">
          I won't send you useless inbox filler. <em>No spam, ever.</em>
      </div>
  </div>

  <div class="ck_form_fields">

    <div id='ck_success_msg'  style='display:none;'>
      <p>Thanks! Please check your email for the link to your cheatsheets.</p>
    </div>

    <!--  Form starts here  -->
    <form id="ck_subscribe_form" class="ck_subscribe_form" action="https://app.convertkit.com/landing_pages/4375/subscribe" data-remote="true">
      <input type="hidden" value="{&quot;embed_style&quot;:&quot;inline&quot;,&quot;embed_trigger&quot;:&quot;scroll_percentage&quot;,&quot;scroll_percentage&quot;:&quot;70&quot;,&quot;delay_seconds&quot;:&quot;10&quot;,&quot;display_position&quot;:&quot;br&quot;,&quot;display_devices&quot;:&quot;all&quot;,&quot;days_no_show&quot;:&quot;15&quot;,&quot;converted_behavior&quot;:&quot;show&quot;}" id="ck_form_options"></input>
      <input type="hidden" name="id" value="4375" id="landing_page_id"></input>
      <div class="ck_errorArea">
        <div id="ck_error_msg" style="display:none">
          <p>There was an error submitting your subscription. Please try again.</p>
        </div>
      </div>
      <div class="ck_control_group ck_first_name_field_group">
        <label class="ck_label" for="ck_firstNameField">First Name</label>
        <input type="text" name="first_name" class="ck_first_name" id="ck_firstNameField"></input>
      </div>
      <div class="ck_control_group ck_email_field_group">
        <label class="ck_label" for="ck_emailField">Email Address</label>
          <input type="email" name="email" class="ck_email_address" id="ck_emailField" required></input>
      </div>
      <label class='ck_checkbox' style='display:none;'>
        <input class="optIn ck_course_opted" name='course_opted' type="checkbox" id="optIn" checked />
        <span class='ck_opt_in_prompt'>I'd like to receive the free email course.</span>
      </label>

      <button class="subscribe_button ck_subscribe_button btn fields" id='ck_subscribe_button'>
       Join over 13,000 subscribers
      </button>
      <span class="ck_guarantee">
        Unsubscribe at any time.
      </span>
    </form>
  </div>

 </div>


<style type="text/css">/* Layout */
  .ck_form {
  /* divider image */
  background: #fff url(data:image/gif;base64,R0lGODlhAQADAIABAMzMzP///yH/C1hNUCBEYXRhWE1QPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS41LWMwMTQgNzkuMTUxNDgxLCAyMDEzLzAzLzEzLTEyOjA5OjE1ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUQ5NjM5RjgxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUQ5NjM5RjkxQUVEMTFFNEJBQTdGNTQwMjc5MTZDOTciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxRDk2MzlGNjFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxRDk2MzlGNzFBRUQxMUU0QkFBN0Y1NDAyNzkxNkM5NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PgH//v38+/r5+Pf29fTz8vHw7+7t7Ovq6ejn5uXk4+Lh4N/e3dzb2tnY19bV1NPS0dDPzs3My8rJyMfGxcTDwsHAv769vLu6ubi3trW0s7KxsK+urayrqqmop6alpKOioaCfnp2cm5qZmJeWlZSTkpGQj46NjIuKiYiHhoWEg4KBgH9+fXx7enl4d3Z1dHNycXBvbm1sa2ppaGdmZWRjYmFgX15dXFtaWVhXVlVUU1JRUE9OTUxLSklIR0ZFRENCQUA/Pj08Ozo5ODc2NTQzMjEwLy4tLCsqKSgnJiUkIyIhIB8eHRwbGhkYFxYVFBMSERAPDg0MCwoJCAcGBQQDAgEAACH5BAEAAAEALAAAAAABAAMAAAICRFIAOw==) repeat-y center top;
  font-family: 'Helvetica Neue', Helvetica, Arial, Verdana, sans-serif;
  line-height: 1.5em;
  overflow: hidden;
  color: #666;
  font-size: 16px;
  border-top: solid 20px #3071b0;
  border-top-color: #b30e2f;
  border-bottom: solid 10px #3d3d3d;
  border-bottom-color: #5f0719;
  -webkit-box-shadow: 0px 0px 5px rgba(0,0,0,.3);
  -moz-box-shadow: 0px 0px 5px rgba(0,0,0,.3);
  box-shadow: 0px 0px 5px rgba(0,0,0,.3);
  clear: both;
  margin: 20px 0px;
}

.ck_form * {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

#ck_subscribe_form {
  clear: both;
}

/* Element Queries — uses JS */

.ck_form_content, .ck_form_fields {
  width: 50%;
  float: left;
  padding: 5%;
}

.ck_form.ck_horizontal {
}

.ck_form_content {
  border-bottom: none;
}

.ck_form.ck_vertical {
  background: #fff;
}

.ck_vertical .ck_form_content, .ck_vertical .ck_form_fields {
  padding: 10%;
  width: 100%;
  float: none;
}

.ck_vertical .ck_form_content {
  border-bottom: 1px dotted #aaa;
  overflow: hidden;
}

/* Trigger the vertical layout with media queries as well */

@media all and (max-width: 499px) {

  .ck_form {
    background: #fff;
  }

  .ck_form_content, .ck_form_fields {
    padding: 10%;
    width: 100%;
    float: none;
  }

  .ck_form_content {
    border-bottom: 1px dotted #aaa;
  }

}

/* Content */

.ck_form_content h3 {
  margin: 0px 0px 15px;
  font-size: 24px;
  padding: 0px;
}


.ck_form_content p {
  font-size: 14px;
}

.ck_image {
  float: left;
  margin-right: 5px;
}

/* Form fields */

.ck_errorArea {
  display: none;
}

#ck_success_msg {
  padding: 10px 10px 0px;
  border: solid 1px #ddd;
  background: #eee;
}

.ck_label {
  font-size: 14px;
  font-weight: bold;
}

.ck_form input[type="text"], .ck_form input[type="email"] {
  font-size: 14px;
  padding: 10px 8px;
  width: 100%;
  border: 1px solid #d6d6d6; /* stroke */
  -moz-border-radius: 4px;
  -webkit-border-radius: 4px;
  border-radius: 4px; /* border radius */
  background-color: #f8f7f7; /* layer fill content */
  margin-bottom: 5px;
  height: auto;
}

.ck_form input[type="text"]:focus, .ck_form input[type="email"]:focus {
  outline: none;
  border-color: #aaa;
}

.ck_checkbox {
  padding: 10px 0px 10px 20px;
  display: block;
  clear: both;
}

.ck_checkbox input.optIn {
  margin-left: -20px;
  margin-top: 0;
}
.ck_form .ck_opt_in_prompt {
  margin-left: 4px;
}
.ck_form .ck_opt_in_prompt p {
  display: inline;
}

.ck_form .ck_subscribe_button {
    width: 100%;
    color: #fff;
    margin: 10px 0px 0px;
    padding:  10px 0px;
    font-size: 18px;
    background: #b30e2f;
    -moz-border-radius: 4px;
    -webkit-border-radius: 4px;
    border-radius: 4px; /* border radius */
    cursor: pointer;
    border: none;
    text-shadow: none;
  }


.ck_form .ck_guarantee {
  color: #626262;
  font-size: 12px;
  text-align: center;
  padding: 5px 0px;
  display: block;
}

.ck_form .ck_powered_by {
  display: block;
  color: #aaa;
}

.ck_form .ck_powered_by:hover {
  display: block;
  color: #444;
}

.ck_converted_content {
  display: none;
  padding: 5%;
  background: #fff;
}



</style>
<p>Thanks for reading, and until next time, happy Governing!</p>
<p>The post <a rel="nofollow" href="/sensible-react-forms-with-govern/">Sensible React Forms, with Govern</a> appeared first on <a rel="nofollow" href="/">James K Nelson</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>/sensible-react-forms-with-govern/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>
